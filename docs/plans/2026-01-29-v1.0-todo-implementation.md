# v1.0 TODO.local.md Implementation Plan

This plan addresses the items in `TODO.local.md` for v1.0 PRD gaps. Order follows Do now (Urgent + Important) then Schedule (Important + Not Urgent). Deferred/Eliminate/Delegate items are not implemented.

## Do now (Urgent + Important)

1. **Download retry with exponential backoff**  
   Add retry logic in `internal/core/downloader.go`: retry on transient errors (network, 5xx, 429, timeout) with exponential backoff; max attempts 3; do not retry on 4xx (except 429) or context cancel. All callers (install, deploy, update, verify --fix) get it via `Downloader.Download`.

2. **Load order management + mod reordering**  
   - Deploy/switch must use profile load order (profile.Mods order: first = lowest priority). Currently `GetInstalledMods` returns by `installed_at`; deploy should order by profile.Mods.  
   - Add CLI: `lmm mod order` or profile subcommand to reorder mods (e.g. move up/down, or accept ordered list).  
   - Ensure `ReorderMods` in core/profile.go is used and that deploy fetches mods in profile order.

3. **Profile configuration overrides (INI / overrides dir)**  
   - Persist `Profile.Overrides` in profile YAML (path → content or path → base64).  
   - Define overrides dir semantics (e.g. `overrides/` under game config or profile-specific).  
   - On deploy/switch: write overrides to game directory (or designated overrides path).  
   - Config/storage: add overrides to ProfileConfig in config/profiles.go; Load/Save; apply in deploy flow.

4. **Profile export/import: load order + overrides + link preferences**  
   - Export: already has mods (load order) and link_method. Add `overrides` (map or list of path+content).  
   - Import: parse overrides; set profile.Overrides; link_method already applied.  
   - Domain: ExportedProfile already has LinkMethod; add Overrides field. Config ExportProfile/ImportProfile to include overrides.

5. **Mod details view (description, images, changelog)**  
   - CLI: `lmm mod show <mod-id> --game <id>` (or similar) that fetches mod by ID and prints description, changelog, image URLs (or “open in browser” for images).  
   - Source: ensure NexusMods (or source) exposes description, changelog, image URLs in Mod or via GetModDetails.  
   - Output: human-readable text; optional --json.

## Schedule (Important + Not Urgent)

6. **Verify: per-mod file-count mismatch**  
   In `cmd/lmm/verify.go`: for each mod with checksums, compare expected file count (e.g. from DB or from re-listing cache) vs actual cached files; report mismatch (e.g. “ModName – expected N files, found M”).

7. **Search filters (category/tags)**  
   CLI: `lmm search --category X --tag Y` (or similar). Source: extend SearchMods/query to pass category/tags to NexusMods (or source) and surface in results.

8. **CLI: lmm list --profiles**  
   When `--profiles` is set, list profile names for the game (and optionally default) instead of listing mods. Simple flag on list command.

9. **Update check: display changelogs**  
   When showing available updates, include changelog text where available (Update struct has Changelog; ensure NexusMods populates it and CLI prints it).

10. **Dependency tree before install + circular dependency warnings**  
    Before installing: print dependency tree (or flat list in dependency order). Detect and warn on circular dependencies (resolver already exists; add cycle detection and explicit warning in install CLI).

---

## Implementation order

- **Phase 1 (this session):** 1 (download retry), then 8 (list --profiles), then 6 (verify file-count).  
- **Phase 2:** 2 (load order + deploy order + CLI reorder), 3 (overrides persist + apply), 4 (export/import overrides).  
- **Phase 3:** 5 (mod details view), 7 (search filters), 9 (changelogs on update), 10 (dependency tree + circular warning).
